

# Документация к шаблону 

Внимание! 
* Для этого шаблона требуется установка Bootstrap.
* Если форма вызывается аяксом, то необходимо вручную поставить ссылку на плагин jquery.form (см. ниже).

## Быстрое начало
Назначьте блоку шаблон "ff/form".
Появится стандартная форма с полями по умолчанию.

## Скрипт для обработки данных формы
Обработка данных формы осуществляется в файле, указанном в "action".
По умолчанию используется скрипт "ff/form/action-default.php", который отправляет данные формы на электронный адрес, заданный в настройках сайта.
Кстати, изучите комментарии в начале этого файла, где дано API этого файла, которое даст дополнительные возможности для конфигурирования вашей формы.

В файле обработки никаких действий по проверке полей производить не нужно, это будет сделано автоматически согласно конфигурации.

Входными данными в этом файле являются
- $_POST['data'] — данные с формы
- $_POST['config'] — массив конфигурации формы, соответствующий массиву JSON в окне редактирования.

Выходные данные
- HTML-код с сообщением о результате выполнения скрипта нужно выводить с помощью обычного echo.

## Конфигурация формы

Если вас не устраивают поля стандартной формы, создайте свою форму.
Для этого отредактируйте JSON массив, находящийся в окне редактирования, согласно образца.
Вы можете проверить код конфигурации на сайте <a href="http://jsonlint.com" target="_blank">jsonlint.com</a>.

Внимание! При использовании приведенного ниже кода, удалите комментарии (двойной слэш и всё, что после него).
<pre>
{
    "action" : "templates/ff/form/action-default.php",
    "method" : "include",
    "target" : "#price",
    "on-error" : "",
    "on-ready" : "alert('тест')",
    "on-success" : "$('#ff-form-'+blockId).change(function(){$('#ff-form-'+blockId+' [type=submit]').click()})",
    "divs" : [
        {
            "class" : "row",
            "id" : "div1",
            "heading" : "Анкета",
            "subheading" : "Вводите реальные данные согласно паспорта",
            "layout":{"fields":"vertical","labels":"left","cols":["col-sm-3","col-sm-9"]},
            "fields" : [
                {
                    "name" : "email",
                    "type" : "input",
                    "label" : "Эл.почта",
                    "default" : "",
                    "placeholder" : "john@doe.com",
                    "mask" : "(999) 999-9999",
                    "selector" : "#email",
                    "on-submit-selector" : ".photos .active .caption",
                    "validation" : "email",
                    "class" : "btn btn-success btn-lg",
                    "attributes" : {"autocomplete":"off"},
                    "notes" : "",
                    // Для type: checkbox, radio, select
                    "options" : ["плохо","хорошо","отлично"],
                    // Для type: checkbox, radio.
                    "checks-layout" : "vertical",
                    // Для type: captcha
                    "color" : "f00",
                    "bg-color" : "ff9",
                    "num-of-chars" : 5,
                    "font-size" : 17,
                    "font-file" : "templates/fonts/Arial.ttf'"
                    "size" : "lg"
                },{
                    // Поле 2
                }
            ]
        },{
            // Раздел 2
        }
    ]
}
</pre>


### Свойства конфигурации

+ **action** —  URL или файл, которому передаются данные формы в случае успешной первичной проверки (валидации) данных.
+ **bg-color** —  Цвет фона в виде шестнадцатеричного числа (по умолчанию прозрачный). Применяется для type: captcha.
+ **checks-layout** —  Расположение элементов checkbox и radio. Возможные значения: vertical, inline (по умолчанию inline). Применяется для type: checkbox, radio.
+ **class** —  CSS класс div элемента раздела или поля (элементы: input, textarea, select, button). Полностью заменяет существующий класс. Обычно используется для кнопок "submit", "file".
+ **color** —  Цвет символов в виде шестнадцатеричного числа (по умолчанию 000000). Применяется для type: captcha.
+ **default** —  Предварительное значение поля (по умолчанию) или текст на кнопке.
+ **divs** —  Разделы формы. Каждый раздел заключается в элемент div. Представление каждого раздела нужно настраивать в отдельном css-файле сайта.
+ **features** —  Особенности внешнего вида поля. Пока только одно значение: "trail" - пристыковать в одну линию поле, следующее за текущим. Остальное см. в TODO.
+ **fields** —  Массив полей.
+ **font-file** —  Путь к файлу шрифта (по умолчанию Blox::info('cms','dir').'/assets/Verdana.ttf'). Применяется для type: captcha.
+ **font-size** —  Размер шрифта (по умолчанию 12). Применяется для type: captcha.
+ **heading** —  Заголовок  раздела.
+ **id** —  id элемента раздела.
+ **label** —  Заголовок поля. Если данное свойство объявить, но оставить пустым ("label":""), то будет разервировано место под заголовок поля, что имеет значение при расположении заголовков слева от поля ввода, то есть, при конфигурации  "layout":{"labels":"left"}. В частности, добавлять пустой заголовок нужно, если вы хотите расположить кнопку отправки формы (type":"submit") под полями ввода.
+ **layout** — Компоновка полей
	+ **labels** —  Расположение названий полей относительно самих полей ввода. Возможные значения: left, top (по умолчанию).
	+ **fields** — Взаимное расположение всех полей раздела. Возможные значения: vertical (по умолчанию), horizontal.
	+ **cols** —  Бутстраповские ширины колонок для названий полей и для самих полей (по умолчанию ["col-sm-4","col-sm-8"]). Применяется только для "layout":{"labels":"left"}.
+ **mask** —  Маска ввода. Подробности см. https://github.com/RobinHerbots/Inputmask , 
	+ Примеры:
		+ Пример, если задается только маска телефона: "mask":"+7 999 999-99-99"
		+ Пример с несколькими настройками: "mask":"{mask: '(999) 999-9999', repeat:10, greedy:false}"
		+ Пример применения функций: "mask" : "{mask: '+7 999 999-99-99', oncomplete: function() {$(this).css('background','#9f9')}, onincomplete: function() {$(this).css('background','#f99')}}". Как видно из кода, текущий элемент поля нужно обозначать, как: $(this).
		<!--
			https://github.com/RobinHerbots/Inputmask
			Preprocessing masks
			You can define the mask as a function which can allow to preprocess the resulting mask. Example sorting for multiple masks or retrieving mask definitions dynamically through ajax. The preprocessing fn should return a valid mask definition.
			$(selector).inputmask({ mask: function () { /* do stuff */ return ["[1-]AAA-999", "[1-]999-AAA"]; }});
		-->
	+ Если шаблон ff/form будет вызываться аяксом, например, в всплывающем модальном окне, то придется заранее на странице <span style="color:red">ИНИЦИИРОВАТЬ ПЛАГИН INPUTMASK</span>: <?php require_once Blox::info('templates','dir').'/ff/form/init-inputmask.inc' ?>
+ **method** —  Метод, с помощью которого передаются данные. Возможные значения: get, post, include (по умолчанию get). 
	+ При значении "include", нужно указывать путь к php-файлу, данные фактически передаются методом post. В этом файле доступен массив $blockInfo текущего блока формы (на шаблоне ff/form) и булева переменная $success. При этом свойство "target" перестает работать, и код отклика выводится в нижней части формы.
+ **name** —  Имя элемента поля — используется в атрибуте &lt;input name="email"&gt;. Запрещено использовать зарезервированное имя "config". Внимание! Не используйте на одной странице две капчи (captcha) с одинаковыми именами.
+ **notes** —  Заметки около поля (еще не реализовано)
+ **num-of-chars** —  Количество символов (по умолчанию 3). Применяется для type: captcha.
+ **on-submit-selector** — CSS-селектор. Действует аналогично свойству "selector", но только в момент	отправки формы.
+ **on-error** — Javascript код, который выполняется после вывода формы с сообщениями об ошибках. В этом коде доступна переменная blockId — номер блока, в котором находится форма. Не делайте в коде переносы строк.
+ **on-ready** — Javascript код, который выполняется после вывода формы и после каждой отправки формы. Подробности см. у свойства "on-error".
+ **on-success** — Javascript код, который выполняется после отправки и успешного выполнения формы.  Подробности см. у свойства "on-error".
+ **options** —  Названия опций для type: radio, checkbox, select. Пример: ["плохо","хорошо","отлично"]
+ **placeholder** —  Подсказка, находящаяся прямо в поле.
+ **selector** —  CSS-селектор, согласно которого на странице будет найдет элемент, и его текст будет вставлен в поле, как предварительное значение. Если необходимо собрать данные с нескольких элементов, можно создать несколько полей формы или использовать только одно поле, но заранее создать на странице невидимый элемент, куда собирать все данные.
+ **size** —  Размер поля ввода. Возможные значения: lg, sm. Для поля с типом submit, то есть для кнопки, вместо этого свойства используйте свойстов "class"
+ **subheading** —  Подзаголовок  раздела.
+ **target** —  Селектор элемента, содержимое которого будет заменено кодом, возвращаемым запросом, указанном в свойстве action. По умолчанию заменяется вся текущая форма.
+ **type** —  Тип поля: input, textarea, hidden, radio, checkbox, select, submit, reset, captcha, file. По умолчанию: input.
+ **validation** —  Тип валидации данных: email, password, login, numeric, filename. Через пробел можно добавить not-empty.

Примечание.
Если вы ищите здесь свойства вроде: subject, emails, reports, то таких свойств здесь нет — они не относятся к шаблону ff/form. Подобные свойства должны быть заданы в action файле.

### Разбиение полей формы на несколько разделов
Количество уровней вложения ключей "divs" неограничено. То есть, вместо ключа "fields" можно написать ключ "divs", и записать поля на более глубоком уровне.

Пример с колонками
<pre>
{
    "action" : "?block=22",
    "divs" : [{
        "class" : "row",
        "divs" : [
            {
                "class" : "col-xs-6",
                "fields" : [...]
            },{
                "class" : "col-xs-6",
                "fields" : [...]
            }
        ]
    }]
}
</pre>


### Сокращенная форма конфигурации
Ключ "divs" верхнего уровня разрешено не указывать:
<pre>
{
    "action" : "templates/ff/form/action-default.php",
    "method" : "include",
    "heading" : "Анкета",
    "fields" : [ ... ]
}
</pre>


## Стили
Тонкую настройку стилей формы делайте отдельно в общем css-файле сайта или создайте для этого файл "templates/ff/form/form.css".
Например:
<pre>.ff-form input.[name="email"] {background-color: yellow}
.ff-form .col-xs-6 {border: solid 1px #333; padding: 5px}
</pre>

## Разное

Внимание! Если форма вызывается аяксом (например, в шаблоне ff/popups), то необходимо вручную в каком-либо из статичных блоков страницы (как правило, во внешнем шаблоне !page.tpl) подключить:

<pre>&lt;?php
Blox::addToFoot(Blox::info('cms','url').'/assets/jquery.form.min.js'); // плагин jquery.form
Blox::addToHead(Blox::info('templates','url').'/ff/form/form.css'); // стиль шаблона
?&gt;</pre>

Если отклик формы происходит долго (более секунды), то желательно отображать индикатор загрузки. Для этого достаточно в файле внешнего шаблона (!page.tpl) добавить две строчки, которые подключают плагин blox.loader:
<pre>&lt;?php
Blox::addToHead(Blox::info('cms','url').'/assets/blox.loader.css');
Blox::addToFoot(Blox::info('cms','url').'/assets/blox.loader.js');
?&gt; </pre>
 